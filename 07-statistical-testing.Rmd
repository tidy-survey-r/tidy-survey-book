# Statistical testing {#c07}

When analyzing results from a survey, the point estimates described in \@ref(c06) are helpful for understanding the data at a high level, but researchers and the public often want to make comparisons between different groups. These comparisons are calculated through statistical testing where we compare the point estimates and the variance estimates of each statistic to see if there are statistically significant differences. The general idea of statistical testing is the same for data obtained through surveys and data obtained in other methods, but the importance lies in ensuring the variance is calculated correctly. Functions in the {survey} and {srvyr} packages allow for the correct estimation of the variances. This chapter will cover the following statistical tests with survey data and functions:

-   Comparison of proportions and means using `svyttest()`
-   Goodness of fit `svychisq()`
-   Tests of association `svychisq()`

These functions are actually from the {survey} package instead of the {srvyr} package and the design object is *not* the first argument. This means that to use these functions with the magrittr pipe `%>%` we will need to use the dot notation. For example:

``` r
data_svydes %>% 
  svyttest(x~y,.)
```

Placing the dot (`.`) in the second argument spot, indicates that the survey design object `data_svydes` should be used in the second argument and not the first (which is the default). All examples with these functions from the {survey} packages that use the magrittr pipe will use this dot notation.

## Chapter Set-Up

For this chapter, we will be using the same data as we did in \@ref(c06): ANES and RECS. As a reminder, we will need to create survey design objects to work with. These design objects ensure that the variance estimation is calculated accurately, and thus we can accurately determine statistical significance.

First, make sure you have installed and loaded the following packages:

```{r c07_setup}
#| error: FALSE
#| warning: FALSE
#| message: FALSE

library(tidyverse)
library(survey) # for survey analysis
library(srvyr) # for tidy survey analysis
library(readr)
library(here)
```

Second, we need to read in the data and create the design objects.

Here is how you create the design object for the ANES data, remember that we need to adjust the weight so it sums to the population instead of the sample. We do that by multiplying the weights (see the ANES methodology documentation for more information).
```{r anes_des_c07}
anes <- read_rds(here("data", "anes_2020.rds")) %>%
   mutate(Weight=Weight/sum(Weight)*231592693) 

anes_des <- anes %>%
   as_survey_design(weights = Weight,
                    strata = Stratum,
                    ids = VarUnit,
                    nest = TRUE)
```

Here is how you create the design object for the RECS data:
```{r recs_des_c07}
recs <-read_rds(here("data", "recs.rds"))

recs_des <- recs %>%
  as_survey_rep(weights = NWEIGHT,
                repweights = starts_with("BRRWT"),
                type = "Fay",
                rho = 0.5,
                mse = TRUE)
```

## Comparison of Proportions and Means

<!--Stat overview, non code based-->
Comparing proportions and means uses t-tests. 

### Syntax

Outside of survey data, we can use the `t.test()` function. This function does not allow for weights or the variance structure to be accounted for with survey data. Therefore, when using survey data, we need to use the `svyttest()` function. Many of the arguments are the same between the two functions, but instead of providing data, we need to provide the survey design object.

``` r
svyttest(formula, 
         design,  
         na.rm=FALSE,
         level=0.95,
         ...)
```

As mentioned in the beginning of this chapter, the `design` parameter is the second argument of the function, therefore, the dot `(.)` 


### Examples

### Exercises

## Comparison of Means

## Goodness of Fit

## Tests of Association
