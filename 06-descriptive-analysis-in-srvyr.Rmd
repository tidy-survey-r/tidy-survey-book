# Descriptive analyses in srvyr {#c06}

## Goals



## Introduction

Descriptive analysis allows you to investigate your dataset and gain insight into the information it contains. Common descriptive analyses include calculating mean, median of numeric data or proportions in categorical data. <!--TODO: Add more, particularly on how it's on the analyst to pick the right way of doing descriptive analysis based on the data-->
      
## Overview of descriptive analysis using `srvyr` package

1. Create a `tbl_svy` object using `srvyr::as_survey_design()` or `srvyr::as_survey_rep()`
2. Subset the data for subpopulations using `dplyr::filter()`, if needed
3. Specify domains of analysis using `dplyr::group_by()` 
4. Within `srvyr::summarize()`, specify variables to calculate means, totals, proportions, quantiles, and more

### A brief refresher on the `dplyr::summarize()` function

The `dplyr::summarize()` function collapses many values down to a single summary:

<!-- TODO: Add example -->

These verbs can be used in conjunction with `group_by()`, applying the functions on a group-by-group basis to create grouped summaries.

Like with `dplyr::summarize()`, we can use multiple functions within `srvyr::summarize()`. We will explore some of these in this chapter.

* Center: `survey_mean()`, `survey_prop()`, `survey_median()`
* Count: `survey_count()`, `survey_total()`
* Range: `survey_quantile()`
* Ratio: `survey_ratio()`
* Variance: `survey_var()`, `survey_sd()`

## Setup

With the ACES data, we create a `tbl_svy` object using `srvyr::as_survey_design` (as described in Chapter 05):

```{r anes_des, error=FALSE, warning=FALSE}
library(survey) # for survey analysis
library(srvyr) # for tidy survey analysis
library(readr)
library(here)

anes <-
  read_rds(here(
    "/Users/ivelasq/R/tidy-survey-short-course/Data/anes_2020.rds"
  )) %>%
  mutate(Weight = Weight / sum(Weight) * 231592693) 
# adjust weight to sum to citizen pop, 18+ in Nov 2020 per ANES methodology documentation

anes_des <- anes %>%
  as_survey_design(
    weights = Weight,
    strata = Stratum,
    ids = VarUnit,
    nest = TRUE
  )
```
  
## Categorical data

_Categorical data_, or the [definition], 

Analyzing categorical data lets us...

Common analysis for categorical data include:

* Weighted proportions
* Weighted counts
* Unweighted proportions
* Unweighted counts

### Count weighted observations by group with `survey_count()`

With `srvyr::survey_count()`, you can produce weighted counts and variance of your choice. The syntax is very similar to the `dplyr::count()` syntax; however, it can only be called on `tbl_srvy()` objects. Let's explore the syntax:

```r
survey_count(
  x,
  ...,
  wt = NULL,
  sort = FALSE,
  name = "n",
  .drop = dplyr::group_by_drop_default(x),
  vartype = c("se", "ci", "var", "cv")
  )
```

The arguments are:

* `x`: a `tbl_svy` object created by `as_survey`
* `...`: variables to group by, passed to `group_by`
* `wt`: a variable to weight on in addition to the survey weights, defaults to `NULL`
* `sort`: how to sort the variables, defaults to `FALSE`
* `name`: the name of the count variable, defaults to `n`
* `.drop`: whether to drop empty groups
* `vartype`: type(s) of variation estimate to calculate, defaults to `se` (standard error)

The steps to use `survey_count()` are:

* Specify the sample design,
* then run `survey_count()`, specifying the required arguments within the function

Let's see the weighted count of responses in ANES:

```{r}
anes_des %>% #  Specify the sample design
  survey_count() # Run `survey_count()`
```

`srvyr::count()` can take one or many variables. To calculate a cross-tab of population in each age group and gender, we run the below:

```{r}
anes_des %>%
  # Specify the required arguments within the function
  survey_count(AgeGroup, Gender, name = "N") 
```

## Calculate mean/proportion using survey methods with `survey_mean()` and `survey_prop()`

The `srvyr::survey_mean()` and `survey_prop()` functions calculate the means and proportions from complex survey data. Let's explore the syntax:

```r
survey_mean(
  x,
  na.rm = FALSE,
  vartype = c("se", "ci", "var", "cv"),
  level = 0.95,
  proportion = FALSE,
  prop_method = c("logit", "likelihood", "asin", "beta", "mean"),
  deff = FALSE,
  df = NULL,
  ...
)

survey_prop(
  vartype = c("se", "ci", "var", "cv"),
  level = 0.95,
  proportion = FALSE,
  prop_method = c("logit", "likelihood", "asin", "beta", "mean"),
  deff = FALSE,
  df = NULL,
  ...
)
```

The steps involved are:

- Specify the sample design,
- then specify the cross tab in `group_by()`,
- then run `survey_mean()` or `survey_prop()` within `summarize()`

```{r}

```


The `survey_prop` function is equivalent to leaving out the x argument in `survey_mean`.

```{r}

```


`survey_count()`, like `dplyr::count()`, is not called within `summarize`. An equivalent method of calculating weighted counts is:

```{r}
anes_des %>%
  group_by(AgeGroup, Gender) %>%
  srvyr::summarize(N = survey_total(), .groups = "drop")
```

Note that the `.groups =` argument controls the grouping structure of the output. When the output no longer have grouping variables because they are dropped, it becomes ungrouped. <!-- TODO: Check this after dplyr 1.1.0 is released -->

### Weighted proportions





