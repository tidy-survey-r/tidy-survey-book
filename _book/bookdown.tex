% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
]{krantz}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.33,0.33,0.33}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.61,0.61,0.61}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.14,0.14,0.14}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.06,0.06,0.06}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.27,0.27,0.27}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.43,0.43,0.43}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0,0,0}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.5,0.5,0.5}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\usepackage{longtable}
\usepackage[bf,singlelinecheck=off]{caption}
\captionsetup[table]{labelsep=space}
\captionsetup[figure]{labelsep=space}
\usepackage[scale=.8]{sourcecodepro}

\usepackage{framed,color}
\definecolor{shadecolor}{RGB}{248,248,248}

\renewcommand{\textfraction}{0.05}
\renewcommand{\topfraction}{0.8}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\floatpagefraction}{0.75}

\renewenvironment{quote}{\begin{VF}}{\end{VF}}
\usepackage{hyperref}
\let\oldhref\href
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}

\makeatletter
\newenvironment{kframe}{%
\medskip{}
\setlength{\fboxsep}{.8em}
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\renewenvironment{Shaded}{\begin{kframe}}{\end{kframe}}

\usepackage{makeidx}
\makeindex

\urlstyle{tt}

\usepackage{amsthm}
\makeatletter
\def\thm@space@setup{%
  \thm@preskip=8pt plus 2pt minus 4pt
  \thm@postskip=\thm@preskip
}
\makeatother

\frontmatter
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{apalike}
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Tidy Survey Book},
  pdfauthor={Stephanie Zimmer, Rebecca Powell, and Isabella Velásquez},
  colorlinks=true,
  linkcolor={Maroon},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Tidy Survey Book}
\author{Stephanie Zimmer, Rebecca Powell, and Isabella Velásquez}
\date{2022-12-04}

\begin{document}
\maketitle

% you may need to leave a few empty pages before the dedication page

%\cleardoublepage\newpage\thispagestyle{empty}\null
%\cleardoublepage\newpage\thispagestyle{empty}\null
%\cleardoublepage\newpage
\thispagestyle{empty}

\begin{center}
To my son,

without whom I should have finished this book two years earlier
%\includegraphics{images/dedication.pdf}
\end{center}

\setlength{\abovedisplayskip}{-5pt}
\setlength{\abovedisplayshortskip}{-5pt}

{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\listoffigures
\listoftables
\hypertarget{preface}{%
\chapter*{Preface}\label{preface}}


Hi there, this is my great book.

\hypertarget{why-read-this-book}{%
\section*{Why read this book}\label{why-read-this-book}}


It is very important\ldots{}

\hypertarget{structure-of-the-book}{%
\section*{Structure of the book}\label{structure-of-the-book}}


Chapters \ref{c01} introduces a new topic, and \ldots{}

\hypertarget{software-information-and-conventions}{%
\section*{Software information and conventions}\label{software-information-and-conventions}}


I used the \textbf{knitr}\index{knitr} package \citep{xie2015} and the \textbf{bookdown}\index{bookdown} package \citep{R-bookdown} to compile my book. My R session information is shown below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{xfun}\SpecialCharTok{::}\FunctionTok{session\_info}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## R version 4.2.2 (2022-10-31)
## Platform: x86_64-apple-darwin17.0 (64-bit)
## Running under: macOS Big Sur ... 10.16
## 
## Locale: en_US.UTF-8 / en_US.UTF-8 / en_US.UTF-8 / C / en_US.UTF-8 / en_US.UTF-8
## 
## Package version:
##   base64enc_0.1.3 bookdown_0.30   bslib_0.4.1    
##   cachem_1.0.6    cli_3.4.1       compiler_4.2.2 
##   digest_0.6.30   evaluate_0.18   fastmap_1.1.0  
##   fs_1.5.2        glue_1.6.2      graphics_4.2.2 
##   grDevices_4.2.2 highr_0.9       htmltools_0.5.3
##   jquerylib_0.1.4 jsonlite_1.8.3  knitr_1.41     
##   lifecycle_1.0.3 magrittr_2.0.3  memoise_2.0.1  
##   methods_4.2.2   R6_2.5.1        rappdirs_0.3.3 
##   renv_0.16.0     rlang_1.0.6     rmarkdown_2.18 
##   sass_0.4.4      stats_4.2.2     stringi_1.7.8  
##   stringr_1.5.0   tinytex_0.42    tools_4.2.2    
##   utils_4.2.2     vctrs_0.5.1     xfun_0.35      
##   yaml_2.3.6
\end{verbatim}

Package names are in bold text (e.g., \textbf{rmarkdown}), and inline code and filenames are formatted in a typewriter font (e.g., \texttt{knitr::knit(\textquotesingle{}foo.Rmd\textquotesingle{})}). Function names are followed by parentheses (e.g., \texttt{bookdown::render\_book()}).

\hypertarget{acknowledgments}{%
\section*{Acknowledgments}\label{acknowledgments}}


A lot of people helped me when I was writing the book.

\begin{flushright}
Frida Gomam\\
on the Mars
\end{flushright}

\mainmatter

\hypertarget{c01}{%
\chapter{Introduction}\label{c01}}

\hypertarget{c02}{%
\chapter{Introducing survey data}\label{c02}}

\hypertarget{c03}{%
\chapter{Understanding survey data files}\label{c03}}

\hypertarget{c04}{%
\chapter{Introducing the srvyr package}\label{c04}}

\hypertarget{c05}{%
\chapter{Specifying sample designs in srvyr}\label{c05}}

\hypertarget{c06}{%
\chapter{Descriptive analyses in srvyr}\label{c06}}

\hypertarget{goals}{%
\section{Goals}\label{goals}}

\hypertarget{introduction}{%
\section{Introduction}\label{introduction}}

Descriptive analysis allows you to investigate your dataset and gain insight into the information it contains. Common descriptive analyses include calculating mean, median of numeric data or proportions in categorical data.

\hypertarget{overview-of-descriptive-analysis-using-srvyr-package}{%
\section{\texorpdfstring{Overview of descriptive analysis using \texttt{srvyr} package}{Overview of descriptive analysis using srvyr package}}\label{overview-of-descriptive-analysis-using-srvyr-package}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create a \texttt{tbl\_svy} object using \texttt{srvyr::as\_survey\_design()} or \texttt{srvyr::as\_survey\_rep()}
\item
  Subset the data for subpopulations using \texttt{dplyr::filter()}, if needed
\item
  Specify domains of analysis using \texttt{dplyr::group\_by()}, if needed
\item
  Within \texttt{srvyr::summarize()}, specify variables to calculate ,means, totals, proportions, quantiles, and more
\end{enumerate}

\hypertarget{a-brief-refresher-on-the-dplyrsummarize-function}{%
\subsection{\texorpdfstring{A brief refresher on the \texttt{dplyr::summarize()} function}{A brief refresher on the dplyr::summarize() function}}\label{a-brief-refresher-on-the-dplyrsummarize-function}}

The \texttt{dplyr::summarize()} function collapses many values down to a single summary:

These verbs can be used in conjunction with \texttt{group\_by()}, applying the functions on a group-by-group basis to create grouped summaries.

\hypertarget{setup}{%
\section{Setup}\label{setup}}

With the ANES data, we create a \texttt{tbl\_svy} object using \texttt{srvyr::as\_survey\_design()} (as described in Chapter 05):

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(survey) }\CommentTok{\# for survey analysis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Loading required package: grid
\end{verbatim}

\begin{verbatim}
## Loading required package: Matrix
\end{verbatim}

\begin{verbatim}
## Loading required package: survival
\end{verbatim}

\begin{verbatim}
## 
## Attaching package: 'survey'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:graphics':
## 
##     dotchart
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(srvyr) }\CommentTok{\# for tidy survey analysis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Attaching package: 'srvyr'
\end{verbatim}

\begin{verbatim}
## The following object is masked from 'package:stats':
## 
##     filter
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(here)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## here() starts at /Users/ivelasq/R/tidy-survey-book
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes }\OtherTok{\textless{}{-}}
  \FunctionTok{read\_rds}\NormalTok{(here}\SpecialCharTok{::}\FunctionTok{here}\NormalTok{(}
    \StringTok{"/Users/ivelasq/R/tidy{-}survey{-}short{-}course/Data/anes\_2020.rds"}
\NormalTok{  )) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Weight =}\NormalTok{ Weight }\SpecialCharTok{/} \FunctionTok{sum}\NormalTok{(Weight) }\SpecialCharTok{*} \DecValTok{231592693}\NormalTok{) }
\CommentTok{\# adjust weight to sum to citizen pop, 18+ in Nov 2020 per ANES methodology documentation}

\NormalTok{anes\_des }\OtherTok{\textless{}{-}}\NormalTok{ anes }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{as\_survey\_design}\NormalTok{(}
    \AttributeTok{weights =}\NormalTok{ Weight,}
    \AttributeTok{strata =}\NormalTok{ Stratum,}
    \AttributeTok{ids =}\NormalTok{ VarUnit,}
    \AttributeTok{nest =} \ConstantTok{TRUE}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\hypertarget{categorical-data}{%
\section{Categorical data}\label{categorical-data}}

\emph{Categorical data}, or the {[}definition{]},

Analyzing categorical data lets us\ldots{}

Common analysis for categorical data include:

\begin{itemize}
\tightlist
\item
  Weighted proportions
\item
  Weighted counts
\item
  Unweighted proportions
\item
  Unweighted counts
\end{itemize}

\hypertarget{count-observations-using-survey-methods-with-survey_count}{%
\subsection{\texorpdfstring{Count observations using survey methods with \texttt{survey\_count()}}{Count observations using survey methods with survey\_count()}}\label{count-observations-using-survey-methods-with-survey_count}}

With \texttt{srvyr::survey\_count()}, you can produce weighted counts and variance of your choice. The syntax is very similar to the \texttt{dplyr::count()} syntax; however, it can only be called on \texttt{tbl\_srvy()} objects. Let's explore the syntax:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{survey\_count}\NormalTok{(}
\NormalTok{  x,}
\NormalTok{  ...,}
  \AttributeTok{wt =} \ConstantTok{NULL}\NormalTok{,}
  \AttributeTok{sort =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{name =} \StringTok{"n"}\NormalTok{,}
  \AttributeTok{.drop =}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{group\_by\_drop\_default}\NormalTok{(x),}
  \AttributeTok{vartype =} \FunctionTok{c}\NormalTok{(}\StringTok{"se"}\NormalTok{, }\StringTok{"ci"}\NormalTok{, }\StringTok{"var"}\NormalTok{, }\StringTok{"cv"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

The arguments are:

\begin{itemize}
\tightlist
\item
  \texttt{x}: a \texttt{tbl\_svy} object created by \texttt{as\_survey}
\item
  \texttt{...}: variables to group by, passed to \texttt{group\_by}
\item
  \texttt{wt}: a variable to weight on in addition to the survey weights, defaults to \texttt{NULL}
\item
  \texttt{sort}: how to sort the variables, defaults to \texttt{FALSE}
\item
  \texttt{name}: the name of the count variable, defaults to \texttt{n}
\item
  \texttt{.drop}: whether to drop empty groups
\item
  \texttt{vartype}: type(s) of variation estimate to calculate, defaults to \texttt{se} (standard error)
\end{itemize}

The steps to use \texttt{survey\_count()} are:

\begin{itemize}
\tightlist
\item
  Specify the sample design,
\item
  Run \texttt{survey\_count()}, specifying the required arguments within the function
\end{itemize}

Let's see the weighted count of responses in ANES:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\#  Specify the sample design}
  \FunctionTok{survey\_count}\NormalTok{() }\CommentTok{\# Run \textasciigrave{}survey\_count()\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##           n     n_se
##       <dbl>    <dbl>
## 1 231592693 3762243.
\end{verbatim}

\texttt{srvyr::count()} can take one or many variables. To calculate a cross-tab of population in each age group and gender, we run the below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \CommentTok{\# Specify the required arguments within the function}
  \FunctionTok{survey\_count}\NormalTok{(AgeGroup, Gender, }\AttributeTok{name =} \StringTok{"N"}\NormalTok{) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 21 x 4
##    AgeGroup Gender         N     N_se
##    <fct>    <fct>      <dbl>    <dbl>
##  1 18-29    Male   21600792. 1418333.
##  2 18-29    Female 22193812. 1766188.
##  3 18-29    <NA>      65204.   56033.
##  4 30-39    Male   19848178. 1077514.
##  5 30-39    Female 19780778. 1158766.
##  6 30-39    <NA>     118195.   62999.
##  7 40-49    Male   17915676. 1123493.
##  8 40-49    Female 18932548.  946369.
##  9 40-49    <NA>      71911.   55174.
## 10 50-59    Male   19054298. 1029844.
## # ... with 11 more rows
\end{verbatim}

\hypertarget{calculate-totals-using-survey-methods-using-survey_total}{%
\section{\texorpdfstring{Calculate totals using survey methods using \texttt{survey\_total()}}{Calculate totals using survey methods using survey\_total()}}\label{calculate-totals-using-survey-methods-using-survey_total}}

With \texttt{srvyr::survey\_total()}, you can calculate totals from complex survey data. Let's explore the syntax:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{survey\_total}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{na.rm =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{vartype =} \FunctionTok{c}\NormalTok{(}\StringTok{"se"}\NormalTok{, }\StringTok{"ci"}\NormalTok{, }\StringTok{"var"}\NormalTok{, }\StringTok{"cv"}\NormalTok{),}
  \AttributeTok{level =} \FloatTok{0.95}\NormalTok{,}
  \AttributeTok{deff =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{df =} \ConstantTok{NULL}\NormalTok{,}
\NormalTok{  ...}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \texttt{x}: a variable, expression, or empty
\item
  \texttt{na.rm}: an indicator of whether missing values should be dropped, defaults to \texttt{FALSE}
\item
  \texttt{vartype}: type(s) of variation estimate to calculate, defaults to \texttt{se} (standard error)
\item
  \texttt{level}: a number or a vector indicating the confidence level, defaults to 0.95
\item
  \texttt{deff}: a logical value stating whether the design effect should be returned, defaults to FALSE
\item
  \texttt{df}: for `vartype = `ci'), a numeric value indicating degrees of freedome for the t-distribution

  \begin{itemize}
  \tightlist
  \item
    For the \{srvyr\} package, this defaults to \texttt{NULL} whereas the \{survey\} package defaults to \texttt{Inf}
  \end{itemize}
\end{itemize}

The steps to use \texttt{survey\_total()} are:

\begin{itemize}
\tightlist
\item
  Specify the sample design,
\item
  Specify the cross tab in \texttt{group\_by()},
\item
  Within \texttt{summarize}, run \texttt{survey\_total()}, specifying the required arguments within the function
\end{itemize}

To calculate a population count estimate with \texttt{survey\_total()}, we can run the below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\FunctionTok{survey\_total}\NormalTok{(), }\AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##        coef    `_se`
##       <dbl>    <dbl>
## 1 231592693 3762243.
\end{verbatim}

The \texttt{.groups\ =} argument controls the grouping structure of the output. When the output no longer have grouping variables because they are dropped, it becomes ungrouped.

Notice that \texttt{anes\_des\ \%\textgreater{}\%\ summarize(survey\_total(),\ .groups\ =\ "drop")} is equivalent to the \texttt{survey\_count()} call:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{survey\_count}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##           n     n_se
##       <dbl>    <dbl>
## 1 231592693 3762243.
\end{verbatim}

The \texttt{survey\_total()} function is called within \texttt{summarize}, where as \texttt{survey\_count()}, like \texttt{dplyr::count()}, is not.

\hypertarget{calculate-meanproportion-using-survey-methods-with-survey_mean-and-survey_prop}{%
\section{\texorpdfstring{Calculate mean/proportion using survey methods with \texttt{survey\_mean()} and \texttt{survey\_prop()}}{Calculate mean/proportion using survey methods with survey\_mean() and survey\_prop()}}\label{calculate-meanproportion-using-survey-methods-with-survey_mean-and-survey_prop}}

The \texttt{srvyr::survey\_mean()} and \texttt{survey\_prop()} functions calculate the means and proportions from complex survey data. Like \texttt{survey\_total()}, they are called within \texttt{summarize()}. Let's explore the syntax:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{survey\_mean}\NormalTok{(}
\NormalTok{  x,}
  \AttributeTok{na.rm =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{vartype =} \FunctionTok{c}\NormalTok{(}\StringTok{"se"}\NormalTok{, }\StringTok{"ci"}\NormalTok{, }\StringTok{"var"}\NormalTok{, }\StringTok{"cv"}\NormalTok{),}
  \AttributeTok{level =} \FloatTok{0.95}\NormalTok{,}
  \AttributeTok{proportion =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{prop\_method =} \FunctionTok{c}\NormalTok{(}\StringTok{"logit"}\NormalTok{, }\StringTok{"likelihood"}\NormalTok{, }\StringTok{"asin"}\NormalTok{, }\StringTok{"beta"}\NormalTok{, }\StringTok{"mean"}\NormalTok{),}
  \AttributeTok{deff =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{df =} \ConstantTok{NULL}\NormalTok{,}
\NormalTok{  ...}
\NormalTok{)}

\FunctionTok{survey\_prop}\NormalTok{(}
  \AttributeTok{vartype =} \FunctionTok{c}\NormalTok{(}\StringTok{"se"}\NormalTok{, }\StringTok{"ci"}\NormalTok{, }\StringTok{"var"}\NormalTok{, }\StringTok{"cv"}\NormalTok{),}
  \AttributeTok{level =} \FloatTok{0.95}\NormalTok{,}
  \AttributeTok{proportion =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{prop\_method =} \FunctionTok{c}\NormalTok{(}\StringTok{"logit"}\NormalTok{, }\StringTok{"likelihood"}\NormalTok{, }\StringTok{"asin"}\NormalTok{, }\StringTok{"beta"}\NormalTok{, }\StringTok{"mean"}\NormalTok{),}
  \AttributeTok{deff =} \ConstantTok{FALSE}\NormalTok{,}
  \AttributeTok{df =} \ConstantTok{NULL}\NormalTok{,}
\NormalTok{  ...}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The steps involved are:

\begin{itemize}
\tightlist
\item
  Specify the sample design,
\item
  Specify the cross tab in \texttt{group\_by()},
\item
  Run \texttt{survey\_mean()} or \texttt{survey\_prop()} within \texttt{summarize()}
\end{itemize}

Looking at population by age group, we can calculate the weighted proportion for each group in the data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(AgeGroup) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{p1 =} \FunctionTok{survey\_mean}\NormalTok{(),}
            \AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 3
##   AgeGroup        p1   p1_se
##   <fct>        <dbl>   <dbl>
## 1 18-29       0.189  0.00838
## 2 30-39       0.172  0.00659
## 3 40-49       0.159  0.00609
## 4 50-59       0.169  0.00657
## 5 60-69       0.155  0.00488
## 6 70 or older 0.119  0.00474
## 7 <NA>        0.0369 0.00305
\end{verbatim}

The \texttt{survey\_prop()} function is equivalent to leaving out the \texttt{x} argument in \texttt{survey\_mean()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(AgeGroup) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{p1 =} \FunctionTok{survey\_prop}\NormalTok{(),}
            \AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 7 x 3
##   AgeGroup        p1   p1_se
##   <fct>        <dbl>   <dbl>
## 1 18-29       0.189  0.00838
## 2 30-39       0.172  0.00659
## 3 40-49       0.159  0.00609
## 4 50-59       0.169  0.00657
## 5 60-69       0.155  0.00488
## 6 70 or older 0.119  0.00474
## 7 <NA>        0.0369 0.00305
\end{verbatim}

\hypertarget{other-functions-that-use-survey-methods}{%
\section{Other functions that use survey methods}\label{other-functions-that-use-survey-methods}}

The \{srvyr\} package includes other functions for summarizing datasets:

\begin{itemize}
\tightlist
\item
  Center: \texttt{survey\_mean()}, \texttt{survey\_prop()}, \texttt{survey\_median()}
\item
  Count: \texttt{survey\_count()}, \texttt{survey\_total()}
\item
  Range: \texttt{survey\_quantile()}
\item
  Ratio: \texttt{survey\_ratio()}
\item
  Variance: \texttt{survey\_var()}, \texttt{survey\_sd()}
\end{itemize}

\hypertarget{conditional-proportions-with-more-than-one-group}{%
\section{Conditional proportions with more than one group}\label{conditional-proportions-with-more-than-one-group}}

Specifying more than one group calculates conditional proportions. Say we wanted to know the proportion of people who voted in 2016 and 2020. After the \texttt{tbl\_svy} object, we specify the two variables we want to calculate proportions for:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2016),}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2020)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(VotedPres2016, VotedPres2020) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarize}\NormalTok{(}
    \AttributeTok{p =} \FunctionTok{survey\_mean}\NormalTok{(),}
    \AttributeTok{N =} \FunctionTok{survey\_total}\NormalTok{(),}
    \AttributeTok{n =} \FunctionTok{unweighted}\NormalTok{(}\FunctionTok{n}\NormalTok{()),}
    \AttributeTok{.groups =} \StringTok{"drop"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 7
##   VotedPre~1 Voted~2      p    p_se      N   N_se     n
##   <fct>      <fct>    <dbl>   <dbl>  <dbl>  <dbl> <int>
## 1 Yes        Yes     0.924  0.00566 1.45e8 2.62e6  5534
## 2 Yes        No      0.0762 0.00566 1.19e7 9.55e5   274
## 3 No         Yes     0.455  0.0162  3.39e7 1.59e6   859
## 4 No         No      0.545  0.0162  4.06e7 2.04e6   761
## # ... with abbreviated variable names
## #   1: VotedPres2016, 2: VotedPres2020
\end{verbatim}

Note that this is the proportion of \textbf{people voting in 2020 by whether people voted in 2016}. That is, it is the weighted number of people who voted in both 2016 and 2020 (144578247), divided by the weighted number of people who voted in 2016 (144578247 + 11917394). Running the above, we see that 92.4\% of people who voted in 2016 voted in 2020.

\hypertarget{joint-proportions-with-more-than-one-group}{%
\section{Joint proportions with more than one group}\label{joint-proportions-with-more-than-one-group}}

There are times when we are not interested in conditional proportions. Instead, we want to calculate multiple variables as if they were a single variable. The \{srvyr\} package includes \texttt{interact}, which we can use within \texttt{group\_by()} to calculate the joint proportions of two or more variables.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2020),}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2016)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\FunctionTok{interact}\NormalTok{(VotedPres2016, VotedPres2020)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\#\textless{}\textless{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{p =} \FunctionTok{survey\_mean}\NormalTok{(),}
            \AttributeTok{N =} \FunctionTok{survey\_total}\NormalTok{(),}
            \AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 6
##   VotedPres2016 VotedPre~1      p    p_se      N   N_se
##   <fct>         <fct>       <dbl>   <dbl>  <dbl>  <dbl>
## 1 Yes           Yes        0.626  0.00934 1.45e8 2.62e6
## 2 Yes           No         0.0516 0.00391 1.19e7 9.55e5
## 3 No            Yes        0.147  0.00628 3.39e7 1.59e6
## 4 No            No         0.176  0.00770 4.06e7 2.04e6
## # ... with abbreviated variable name 1: VotedPres2020
\end{verbatim}

Since \texttt{interact} groups by multiple variables as if they were a single variable, the proportions sum to 100\% across more than a single grouping variable.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2020),}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2016)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\FunctionTok{interact}\NormalTok{(VotedPres2016, VotedPres2020)) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\#\textless{}\textless{}}
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{p =} \FunctionTok{survey\_mean}\NormalTok{(),}
            \AttributeTok{N =} \FunctionTok{survey\_total}\NormalTok{(),}
            \AttributeTok{.groups =} \StringTok{"drop"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarize}\NormalTok{(}\AttributeTok{p\_sum =} \FunctionTok{sum}\NormalTok{(p))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   p_sum
##   <dbl>
## 1     1
\end{verbatim}

\hypertarget{proportions-with-design-effects}{%
\section{Proportions with design effects}\label{proportions-with-design-effects}}

Note above that functions \texttt{survey\_total()}, \texttt{survey\_mean()}, and \texttt{survey\_prop()} have the argument \texttt{deff}. \texttt{deff} stands for Design Effect, the ratio of two variances. Use \texttt{deff\ =\ TRUE} argument to specify whether the design effect should be returned.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{anes\_des }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2016), }\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(VotedPres2020)) }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{group\_by}\NormalTok{(}\FunctionTok{interact}\NormalTok{(VotedPres2016, VotedPres2020)) }\SpecialCharTok{\%\textgreater{}\%} 
   \FunctionTok{summarize}\NormalTok{(}
      \AttributeTok{p=}\FunctionTok{survey\_mean}\NormalTok{(}\AttributeTok{deff=}\ConstantTok{TRUE}\NormalTok{), }\CommentTok{\#\textless{}\textless{}}
      \AttributeTok{N=}\FunctionTok{survey\_total}\NormalTok{()}
\NormalTok{   )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 7
##   VotedPr~1 Voted~2      p    p_se p_deff      N   N_se
##   <fct>     <fct>    <dbl>   <dbl>  <dbl>  <dbl>  <dbl>
## 1 Yes       Yes     0.626  0.00934   2.76 1.45e8 2.62e6
## 2 Yes       No      0.0516 0.00391   2.32 1.19e7 9.55e5
## 3 No        Yes     0.147  0.00628   2.34 3.39e7 1.59e6
## 4 No        No      0.176  0.00770   3.04 4.06e7 2.04e6
## # ... with abbreviated variable names
## #   1: VotedPres2016, 2: VotedPres2020
\end{verbatim}

\hypertarget{c07}{%
\chapter{Statistical testing}\label{c07}}

\hypertarget{c08}{%
\chapter{Modeling}\label{c08}}

\hypertarget{c09}{%
\chapter{Presenting results}\label{c09}}

\cleardoublepage

\hypertarget{appendix-appendix}{%
\appendix \addcontentsline{toc}{chapter}{\appendixname}}


\hypertarget{more-to-say}{%
\chapter{More to Say}\label{more-to-say}}

Yeah! I have finished my book, but I have more to say about some topics. Let me explain them in this appendix.

To know more about \textbf{bookdown}, see \url{https://bookdown.org}.

This is for testing GH Actions.

  \bibliography{book.bib,packages.bib}

\backmatter
\printindex

\end{document}
