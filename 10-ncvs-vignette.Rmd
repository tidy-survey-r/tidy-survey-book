# National Crime Victimization Survey Vignette {#ncvs-vignette}

The National Crime Victimization Survey (NCVS) is a household survey sponsored by the Bureau of Justice Statistics (BJS) which collects data on criminal victimization including characteristics of the crimes, offenders, and victims. Both household and personal crimes are including violent and non-violent crimes. The target population of this survey is all people in the United States age 12 and older living in housing units and noninstitutional group quarters. The NCVS has been ongoing since 1992 and an earlier survey, the National Crime Survey was run from 1972 to 1991 (@ncvs_tech_2016). The survey is administered using a rotating panel. When an address enters the sample, the residents of that address are interviewed every 6 months for a total of 7 interviews. If the initial residents move away from the address during the period, the new residents are included in the survey and people are not followed when they move.

NCVS data is publicly available and distributed by Inter-university Consortium for Political and Social Research (ICPSR)^[https://www.icpsr.umich.edu/web/ICPSR/series/95] with data going back to 1992. The vignette in this book will include data from 2021. The NCVS data structure is complicated and the User's Guide includes examples for analysis in SAS, SUDAAN, SPSS, and Stata, but not R (@ncvs_user_guide). This vignette will adapt those examples for R.

## Data structure

The data files from ICPSR are distributed with five files with their unique identifiers indicated:

- Address Record - YEARQ, IDHH
- Household Record - YEARQ, IDHH
- Person Record - YEARQ, IDHH, IDPER
- Incident Record - YEARQ, IDHH, IDPER
- 2021 Collection Year Incident - YEARQ, IDHH, IDPER

We will be focused on the household, person, and incident files. From these files, we selected a subset of columns for examples and have included the subset on the book's GitHub repository and the file subsets will be used in this vignette. 

## Data file preparation

Some work is necessary to prepare the files before analysis. The design variables indicating pseduostratum (V2117) and half-sample code (V2118) are only included on the household file so need to be added to the person and incident files for any analysis. To calculate victimization rates, one needs to know about the victimization status for both victims and non-victims so the incident file must be summarized and then merged on to the household or person files for person-level and household-level crimes, respectively. We will begin this vignette discussing how to create these incident summary files. This is following Section 2.2 of the NCVS User's Guide.

### Preparing files for estimation of victimization rates

Each record on the incident file represents one incident, which is not the same as one victimization. Some incidents have several instances occurring that make it difficult for the victim to differentiate the details of these victimizations and these are labeled as series crimes. Appendix A of the User's Guide indicates how to calculate the series weight in other statistical languages and that code is adapted here for R. Essentially, if an incident is a series crime, its series weight is top-coded at 10 based on the number of actual victimizations. If something is a series crime and the number of occurrences is unknown, the series weight is set to 6.

```{r}
#| label: incfile

library(tidyverse)
library(srvyr)
library(tidylog)

inc_in <- read_rds(here::here("AnalysisData", "ncvs_2021_incident.rds"))

inc_series <- inc_in %>%
  mutate(
    series=case_when(
      str_detect(V4017, "(1)|(8)")|
        str_detect(V4018, "(2)|(8)")|
        str_detect(V4017, "(1)|(8)")~1,
      TRUE~2
    ),
    n10v4016=case_when(
      V4016 %in% c(997, 998) ~ NA_real_,
      V4016 > 10 ~10,
      TRUE ~ V4016
    ),
    serieswgt=case_when(
      series==2 & is.na(n10v4016)~6,
      series==2 ~ n10v4016,
      TRUE ~ 1
    ),
    NEWWGT=WGTVICCY*serieswgt
  )
```

The next step to prepare the files for estimation is to create indicators on the victimization file for characteristics of interest. Almost all BJS publications limit the analysis to records where the victimization occurred in the United States, that is where V4022 is not equal to 1, and we will do this for all estimates as well.

In the following example, we will make the following indicators:

1. Property crime
    - V4529 >= 31
    - Variable: Property
2. Violent crime
    - V4529 <= 20
    - Variable: Violent
3. Property crime reported to the police
    - V4529 >= 31 and V4399=1
    - Variable: Property_ReportPolice
4. Violent crime reported to the police
    - V4529 < 31 and V4399=1
    - Variable: Violent_ReportPolice
5. Aggravated assault without a weapon
    - V4529 in 11:12 and V4049=2
    - Variable: AAST_NoWeap
6. Aggravated assault with a firearm
    - V4529 in 11:12 and V4049=1 and (V4051=1 or V4052=1 or V4050=7)
    - Variable: AAST_Firearm
7. Aggravated assault with a knife or sharp object
    - V4529 in 11:12 and V4049=1 and (V4053=1 or V4054=1)
    - Variable: AAST_Knife
8. Aggravated assault with another type of weapon
    - V4529 in 11:12 and V4049=1 and V4050=1 and not firearm or knife
    - Variable: AAST_Other
    
```{r}
#| label: inc_inds

inc_ind <- inc_series %>%
  filter(V4022!="(1) Outside U.S.") %>%
  mutate(
    WeapCat=case_when(
      is.na(V4049)~NA_character_,
      V4049=="(2) No"~"NoWeap",
      V4049=="(3) Don't know"~"UnkWeapUse",
      V4050=="(3) Yes weapon-NA"~"Other",
      V4051=="(1) Yes"|V4052=="(1) Yes"|V4050=="(7) Gun type unknown"~"Firearm",
      V4053=="(1) Yes"|V4054=="(1) Yes"~"Knife",
      TRUE ~ "Other"
    ),
    V4529_num=parse_number(as.character(V4529)),
    ReportPolice=V4399=="(1) Yes",
    Property=V4529_num>=31,
    Violent=V4529_num<=20,
    Property_ReportPolice=Property & ReportPolice,
    Violent_ReportPolice=Violent & ReportPolice,
    AAST=V4529_num %in% 11:12,
    AAST_NoWeap=AAST & WeapCat=="NoWeap",
    AAST_Firearm=AAST & WeapCat=="Firearm",
    AAST_Knife=AAST & WeapCat=="Knife",
    AAST_Other=AAST & WeapCat=="Other",
  )


# Checking derived variables
inc_series %>% count(V4022)
inc_ind %>% count(V4022)
inc_ind %>% count(WeapCat, V4049, V4050, V4051, V4052, V4052, V4053, V4054)
inc_ind %>% count(V4529_num, V4529, Property, Violent, AAST) %>% print(n=40)
inc_ind %>% count(ReportPolice, V4399)
inc_ind %>% count(AAST, WeapCat, AAST_NoWeap, AAST_Firearm, AAST_Knife, AAST_Other)
```

After creating indicators of victimization types and characteristics, the file is summarized and crimes are summed across persons or households by YEARQ. Property crimes are summed across households and personal crimes (violent plus purse snatching and pocket-picking) are summed across persons. The indicators are summed using the serieswgt and the WGTVICCY needs to be retained for later analysis.

```{r}
#| label: inc_sum

inc_hh_sums <- 
  inc_ind %>%
  filter(V4529_num > 23) %>% # restrict to household crimes
  group_by(YEARQ, IDHH) %>%
  summarise(
    WGTVICCY=WGTVICCY[1],
    across(starts_with("Property"), ~sum(. * serieswgt), .names="{.col}"),
    .groups="drop"
  )

inc_pers_sums <- 
  inc_ind %>%
  filter(V4529_num <= 23) %>% # restrict to person crimes
  group_by(YEARQ, IDHH, IDPER) %>%
  summarise(
    WGTVICCY=WGTVICCY[1],
    across(c(starts_with("Violent"), starts_with("AAST")), ~sum(. * serieswgt), .names="{.col}"),
    .groups="drop"
  )


```

The victimization summary files are then merged onto the appropriate files. For any record on the household or person file that is not on the victimization file, the victimization counts are set to 0 after merging. In this step, we will also create the victimization adjustment factor. See 2.2.4 in the User's Guide for details of why this adjustment is created. It is calculated as follows:

$$ A_{ijk}=\frac{v_{ijk}}{w_{ijk}}$$ 

where $w_{ijk}$ is the person weight (WGTPERCY) for personal crimes or the household weight (WGTHHCY) for household crimes and $v_{ijk}$ is the victimization weight (WGTVICCY) for household $i$, respondent $j$, in reporting period $k$. The adjustment factor is set to 0 if no incidents are reported.

```{r}
#| label: merge_inc_sum

hh_in <- read_rds(here::here("AnalysisData", "ncvs_2021_household.rds"))
pers_in <- read_rds(here::here("AnalysisData", "ncvs_2021_person.rds"))

# set up a list of 0s for each crime type/characteristic to replace NA's later
hh_z_list <- rep(0, ncol(inc_hh_sums)-3) %>% as.list() %>% setNames(names(inc_hh_sums)[-(1:3)])
pers_z_list <- rep(0, ncol(inc_pers_sums)-4) %>% as.list() %>% setNames(names(inc_pers_sums)[-(1:4)])

hh_vsum <- hh_in %>%
  full_join(inc_hh_sums, by=c("YEARQ", "IDHH")) %>%
  replace_na(hh_z_list) %>%
  mutate(
    ADJINC_WT=if_else(is.na(WGTVICCY), 0, WGTVICCY/WGTHHCY)
  )

pers_vsum <- pers_in %>%
  full_join(inc_pers_sums, by=c("YEARQ", "IDHH", "IDPER")) %>%
  replace_na(pers_z_list) %>%
    mutate(
    ADJINC_WT=if_else(is.na(WGTVICCY), 0, WGTVICCY/WGTPERCY)
  )
```

### Derived demographic variables

A final step in file preparation for the household and person files is creating any derived variables on the household and person files such as income categories or age categories for subgroup analysis. This step can done before or after merging on the victimization counts.

    <!-- V2015, V2143, SC214A, V2122, V2126B, V2127B, V2129 -->
    <!-- # tenure, urbanicity, income, family structure, place size, region, msa status -->
    
For the household file, in the following example, we create categories for tenure (rental status), urbanicity, income, place size, and region. For the person file, we create categories for sex, race/Hispanic origin, age categories, and marital status. We also merge on the household demographics to the person file as well as the design variables (V2117 and V2118).

```{r}
#| label: hh_pers_der

hh_vsum_der <- hh_vsum %>%
  mutate(
    Tenure=factor(
      case_when(
        str_detect(V2015, "1")~ "Owned",
        !is.na(V2015)~"Rented"
      ),
      levels=c("Owned", "Rented")
    ),
    Urbanicity=fct_reorder(str_remove(V2143, "\\(\\d\\) "), as.numeric(V2143)),
    SC214A_num=as.numeric(str_extract(SC214A, "\\d+")),
    Income=case_when(
      SC214A_num <= 8~ "Less than $25,000",
      SC214A_num <= 12~ "$25,000-49,999",
      SC214A_num <= 15~ "$50,000-99,999",
      SC214A_num <= 17~ "$100,000-199,999",
      SC214A_num <= 18~ "$200,000 or more",
    ),
    Income=fct_reorder(Income, SC214A_num),
    V2126B_num=as.numeric(str_extract(V2126B, "\\d+")),
    PlaceSize=case_when(
      V2126B_num <= 20~ str_sub(V2126B, 6),
      !is.na(V2126B_num)~"1,000,000 or more"
    ),
    PlaceSize=fct_reorder(PlaceSize, V2126B_num),
    Region=fct_reorder(str_sub(V2127B, 5), as.numeric(V2127B))
  )

hh_vsum_der %>% count(Tenure, V2015)
hh_vsum_der %>% count(Urbanicity, V2143)
hh_vsum_der %>% count(Income, SC214A)
hh_vsum_der %>% count(PlaceSize, V2126B)
hh_vsum_der %>% count(Region, V2127B)

hh_vsum_slim <- hh_vsum_der %>%
  select(YEARQ:V2118, WGTVICCY:ADJINC_WT, Tenure, Urbanicity, Income, PlaceSize, Region)

pers_vsum_der <- pers_vsum %>%
  mutate(
    Sex=fct_reorder(str_sub(V3018, 5), as.numeric(V3018)), 
    RaceHispOrigin=factor(
      case_when(
        str_detect(V3024, "Yes") ~ "Hispanic",
        str_detect(V3023A, "White only")~"White",
        str_detect(V3023A, "Black only")~"Black",
        str_detect(V3023A, "Asian only")~"Asian/Native Awaiian/Other Pacific Islander",
        str_detect(V3023A, "Hawaiian/Pacific IS only")~"Asian/Native Awaiian/Other Pacific Islander",
        TRUE ~ "Other"
      ),
      levels=c("White", "Black", "Hispanic", "Asian/Native Awaiian/Other Pacific Islander", "Other")
    ),
    AgeGroup=case_when(
      V3014<=17 ~ "12-17",
      V3014<=24 ~ "18-24",
      V3014<=34 ~ "25-34",
      V3014<=49 ~ "35-49",
      V3014<=64 ~ "50-64",
      V3014<=90 ~ "65 or older",
    ),
    AgeGroup=fct_reorder(AgeGroup, V3014),
    MaritalStatus=factor(
      case_when(
      str_detect(V3015, "Residue")~NA_character_,
      TRUE ~ str_sub(V3015, 5)
    ),
    levels=c("Never married", "Married", "Widowed", "Divorced", "Separated"))
  ) %>%
  left_join(
    select(hh_vsum_slim, YEARQ, IDHH, V2117, V2118, Tenure:Region),
    by=c("YEARQ", "IDHH")
  )

pers_vsum_der %>% count(Sex, V3018)
pers_vsum_der %>% count(V3023A)
pers_vsum_der %>% count(RaceHispOrigin, V3024)
pers_vsum_der %>% filter(RaceHispOrigin!="Hispanic"|is.na(RaceHispOrigin)) %>% count(RaceHispOrigin, V3023A)
pers_vsum_der %>% group_by(AgeGroup) %>% summarise(minAge=min(V3014), maxAge=max(V3014), .groups="drop")
pers_vsum_der %>% count(MaritalStatus, V3015)

pers_vsum_slim <- pers_vsum_der %>%
  select(YEARQ:WGTPERCY, WGTVICCY:ADJINC_WT, Sex:Region)
```

    <!-- V3014, V3015, V3018, V3023A, V3024, V3084, V3086  -->
    <!-- # age, marital status, sex, race, hispanic origin, gender, sexual orientation -->

The files `hh_vsum_slim` and `pers_vsum_slim` can now be used to create design objects and calculate crime rate estimates. To calculate estimates about types of crime, such as what percentage of violent crimes are reported to the police, the incident file must be used. The incident file is not guaranteed to have every pseudostratum and half-sample code so dummy records are created of these to append before estimation. Additionally, demographic variables are merged onto the incident file.

```{r}
#| label: inc_analysis
dummy_records <- hh_vsum_slim %>%
  distinct(V2117, V2118) %>%
  mutate(
    Dummy=1,
    WGTVICCY=1,
    NEWWGT=1
    )

inc_analysis <- inc_ind %>%
  mutate(Dummy=0) %>%
  left_join( # merge on demographics and design variables
    select(pers_vsum_slim, YEARQ, IDHH, IDPER, Sex:Region),
    by=c("YEARQ", "IDHH", "IDPER")) %>%
  bind_rows(dummy_records) %>%
  select(YEARQ:IDPER, WGTVICCY, NEWWGT, WeapCat, ReportPolice, Property:Region)
```


# Survey design objects

All of the data prep above is necessary to get the data ready for survey analysis. At this point, we can create the design objects and finally begin analysis. Three design objects will be created and these will be used for different types of analysis as it depends which type of estimate you are creating. 


